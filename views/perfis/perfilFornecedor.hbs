<div class="app app--perfil">
  <section class="perfil-header">
    <form id="formFoto" action="/perfil/upload-foto" method="POST" enctype="multipart/form-data">
      <input type="file" id="inputFoto" name="fotoPerfil" style="display:none" onchange="this.form.submit()">
    </form>

    <div class="perfil-container">
      <div class="foto-perfil" onclick="document.getElementById('inputFoto').click()">
        {{#if usuario.photoURL}}
          <img src="{{usuario.photoURL}}" alt="Foto do usuário" />
        {{else}}
          <img src="/assets/default-user.png" alt="Foto padrão" />
        {{/if}}
        <div class="editar-texto">Clique para editar</div>
      </div>

      <div class="info-usuario">
        <h3>{{#if usuario.nome}}{{usuario.nome}}{{else}}Usuário{{/if}}</h3>
      </div>
    </div>

    <div class="perfil-meta-container">
      <!-- ESTATÍSTICAS -->
      <div class="stats">
        <div>
          <p><strong>Avaliação</strong></p>
          <p>{{avaliacaoFornecedor}}</p>
        </div>
        <div>
          <p><strong>Serviços Prestados</strong></p>
          <p>{{servicosPrestados}}</p>
        </div>
        <div>
          <p><strong>Favoritos</strong></p>
          <p>{{#if usuario.favoritosCount}}{{usuario.favoritosCount}}{{else}}0{{/if}}</p>
        </div>
      </div>

      <!-- BOTÕES (EDITAR + AVALIAÇÕES + FAVORITO) -->
      <div class="perfil-editar-btn-container">

        {{!-- DONO DO PERFIL (FORNECEDOR LOGADO) --}}
        {{#if isOwner}}
          <a href="/perfil/fornecedor/{{usuario.id}}/avaliacoes" class="btn btn-editar-perfil">Ver Avaliações</a>
          <a href="/perfil/editar" class="btn btn-editar-perfil">Editar Perfil</a>
        {{/if}}

        {{!-- ORGANIZADOR VENDO UM FORNECEDOR --}}
        {{#if (eq visitante.tipo "organizador")}}
          {{#unless isOwner}}
            <a href="/perfil/fornecedor/{{usuario.id}}/avaliacoes"
               class="btn btn-editar-perfil">
               Ver Avaliações
            </a>

            <button 
              type="button"
              class="btn btn-favorito {{#if isFavorito}}botaoCancelar{{else}}botaoConfirmar{{/if}}"
              data-id="{{usuario.id}}"
              data-nome="{{usuario.nome}}"
              style="padding: 8px 12px;">
              {{#if isFavorito}}
                ⭐ Remover Favorito
              {{else}}
                ⭐ Adicionar Favorito
              {{/if}}
            </button>
          {{/unless}}
        {{/if}}

      </div>
    </div>
  </section>

  <hr>

  <div class="container-secoes">

    <!-- SOBRE NÓS -->
    <section class="secao secao-sobre-nos">
      <h2>Sobre Nós</h2>
      {{#if usuario.sobreNos}}
        <p id="descricao-sobre-nos">{{usuario.sobreNos}}</p>
      {{else}}
        <p id="descricao-sobre-nos">Este fornecedor ainda não escreveu sobre si.</p>
      {{/if}}

      {{#if isOwner}}
        <div class="botoes">
          <button id="btn-abrir-modal-descricao" type="button" class="botao botaoConfirmar" style="padding: 8px 16px; font-size: 14px;">
            Alterar Descrição
          </button>
        </div>
      {{/if}}
    </section>

    <hr>

    <!-- SERVIÇOS -->
    <section class="secao">
      <h2>Serviços (Produtos)</h2>
      <div class="cards">
        {{#if servicos.length}}
          {{#each servicos}}
            {{#if ../isOwner}}
              <a href="/servicos/editar/{{this.id}}" class="card card-evento">
            {{else}}
              <a href="/servicos/{{this.id}}" class="card card-evento">
            {{/if}}
                {{#if this.imagens.[0]}}
                  <img src="{{this.imagens.[0]}}" class="card-empresa-foto" alt="Imagem da empresa">
                {{else}}
                  <div class="card-empresa-placeholder">Sem imagem</div>
                {{/if}}
                <p class="card-empresa-nome">{{this.nome}}</p>
              </a>
          {{/each}}
        {{else}}
          <div class="semServicos" style="padding: 1rem; min-height: 100px;">
            <p>Nenhum serviço cadastrado ainda.</p>
          </div>
        {{/if}}
      </div>

      {{#if isOwner}}
        <div class="botoes">
          <a href="/servicos/cadastrar" class="btn">Cadastrar Serviço</a>
        </div>
      {{/if}}
    </section>

    <hr>

    <!-- FOTOS -->
    <section class="secao">
      <h2>Fotos de Eventos (Portfólio)</h2>
      <div class="cards">
        {{#if fotos.length}}
          {{#each fotos}}
            <a href="{{this.url}}" class="card card-foto" target="_blank">
               <img src="{{this.url}}" alt="Foto do portfólio">
            </a>
          {{/each}}
        {{else}}
          <div class="semServicos" style="padding: 1rem; min-height: 100px;">
            <p>Nenhuma foto de portfólio cadastrada.</p>
          </div>
        {{/if}}
      </div>

      {{#if isOwner}}
        <div class="botoes">
          <button class="btn">Adicionar Fotos</button>
        </div>
      {{/if}}
    </section>

  </div>
</div>

{{#if isOwner}}
  <script src="/js/perfilFornecedor.js"></script>
{{/if}}

{{#if (eq visitante.tipo "organizador")}}
  {{#unless isOwner}}
    <script src="/js/favoritos.js"></script>
  {{/unless}}
{{/if}}
